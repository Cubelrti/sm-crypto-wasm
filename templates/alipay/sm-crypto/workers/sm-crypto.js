"use strict";function l(n,e,t){return e<=n&&n<=t}function W(n,e){return n.indexOf(e)!==-1}function M(n){if(n===void 0)return{};if(n===Object(n))return n;throw TypeError("Could not convert argument to dictionary")}function R(n){for(var e=String(n),t=e.length,r=0,o=[];r<t;){var i=e.charCodeAt(r);if(i<55296||i>57343)o.push(i);else if(56320<=i&&i<=57343)o.push(65533);else if(55296<=i&&i<=56319)if(r===t-1)o.push(65533);else{var f=e.charCodeAt(r+1);if(56320<=f&&f<=57343){var w=i&1023,c=f&1023;o.push(65536+(w<<10)+c),r+=1}else o.push(65533)}r+=1}return o}function Y(n){for(var e="",t=0;t<n.length;++t){var r=n[t];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}function N(n){return 0<=n&&n<=127}var z=N,b=-1;function B(n){this.tokens=[].slice.call(n),this.tokens.reverse()}B.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():b},prepend:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.push(e.pop());else this.tokens.push(n)},push:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.unshift(e.shift());else this.tokens.unshift(n)}};var y=-1;function E(n,e){if(n)throw TypeError("Decoder error");return e||65533}function k(n){return n=String(n).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(j,n)?j[n]:null}var q=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"}],j={};q.forEach(function(n){n.encodings.forEach(function(e){e.labels.forEach(function(t){j[t]=e})})});var S={},C={},F="utf-8";function h(n,e){if(!(this instanceof h))throw TypeError("Called as a function. Did you forget 'new'?");n=n!==void 0?String(n):F,e=M(e),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var t=k(n);if(t===null||t.name==="replacement")throw RangeError("Unknown encoding: "+n);if(!C[t.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?");var r=this;return r._encoding=t,e.fatal&&(r._error_mode="fatal"),e.ignoreBOM&&(r._ignoreBOM=!0),Object.defineProperty||(this.encoding=r._encoding.name.toLowerCase(),this.fatal=r._error_mode==="fatal",this.ignoreBOM=r._ignoreBOM),r}Object.defineProperty&&(Object.defineProperty(h.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(h.prototype,"fatal",{get:function(){return this._error_mode==="fatal"}}),Object.defineProperty(h.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}}));h.prototype.decode=function(e,t){var r;typeof e=="object"&&e instanceof ArrayBuffer?r=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):r=new Uint8Array(0),t=M(t),this._do_not_flush||(this._decoder=C[this._encoding.name]({fatal:this._error_mode==="fatal"}),this._BOMseen=!1),this._do_not_flush=!!t.stream;for(var o=new B(r),i=[],f;;){var w=o.read();if(w===b||(f=this._decoder.handler(o,w),f===y))break;f!==null&&(Array.isArray(f)?i.push.apply(i,f):i.push(f))}if(!this._do_not_flush){do{if(f=this._decoder.handler(o,o.read()),f===y)break;f!==null&&(Array.isArray(f)?i.push.apply(i,f):i.push(f))}while(!o.endOfStream());this._decoder=null}function c(g){return W(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)&&!this._ignoreBOM&&!this._BOMseen&&(g.length>0&&g[0]===65279?(this._BOMseen=!0,g.shift()):g.length>0&&(this._BOMseen=!0)),Y(g)}return c.call(this,i)};function A(n,e){if(!(this instanceof A))throw TypeError("Called as a function. Did you forget 'new'?");e=M(e),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=e.fatal?"fatal":"replacement";var t=this;if(e.NONSTANDARD_allowLegacyEncoding){n=n!==void 0?String(n):F;var r=k(n);if(r===null||r.name==="replacement")throw RangeError("Unknown encoding: "+n);if(!S[r.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");t._encoding=r}else t._encoding=k("utf-8");return Object.defineProperty||(this.encoding=t._encoding.name.toLowerCase()),t}Object.defineProperty&&Object.defineProperty(A.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}});A.prototype.encode=function(e,t){e=e===void 0?"":String(e),t=M(t),this._do_not_flush||(this._encoder=S[this._encoding.name]({fatal:this._fatal==="fatal"})),this._do_not_flush=!!t.stream;for(var r=new B(R(e)),o=[],i;;){var f=r.read();if(f===b||(i=this._encoder.handler(r,f),i===y))break;Array.isArray(i)?o.push.apply(o,i):o.push(i)}if(!this._do_not_flush){for(;i=this._encoder.handler(r,r.read()),i!==y;)Array.isArray(i)?o.push.apply(o,i):o.push(i);this._encoder=null}return new Uint8Array(o)};function V(n){var e=n.fatal,t=0,r=0,o=0,i=128,f=191;this.handler=function(w,c){if(c===b&&o!==0)return o=0,E(e);if(c===b)return y;if(o===0){if(l(c,0,127))return c;if(l(c,194,223))o=1,t=c&31;else if(l(c,224,239))c===224&&(i=160),c===237&&(f=159),o=2,t=c&15;else if(l(c,240,244))c===240&&(i=144),c===244&&(f=143),o=3,t=c&7;else return E(e);return null}if(!l(c,i,f))return t=o=r=0,i=128,f=191,w.prepend(c),E(e);if(i=128,f=191,t=t<<6|c&63,r+=1,r!==o)return null;var g=t;return t=o=r=0,g}}function $(n){n.fatal,this.handler=function(e,t){if(t===b)return y;if(z(t))return t;var r,o;l(t,128,2047)?(r=1,o=192):l(t,2048,65535)?(r=2,o=224):l(t,65536,1114111)&&(r=3,o=240);for(var i=[(t>>6*r)+o];r>0;){var f=t>>6*(r-1);i.push(128|f&63),r-=1}return i}}S["UTF-8"]=function(n){return new $(n)};C["UTF-8"]=function(n){return new V(n)};var O=O||globalThis||{};O.TextEncoder=typeof A>"u"?A:O.TextEncoder;O.TextDecoder=typeof h>"u"?h:O.TextDecoder;let u;const d=new Array(128).fill(void 0);d.push(void 0,null,!0,!1);function s(n){return d[n]}let x=d.length;function G(n){n<132||(d[n]=x,x=n)}function D(n){const e=s(n);return G(n),e}function a(n){x===d.length&&d.push(d.length+1);const e=x;return x=d[e],d[e]=n,e}const P=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&P.decode();let p=null;function H(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(u.memory.buffer)),p}function v(n,e){return n=n>>>0,P.decode(H().subarray(n,n+e))}function _(n,e){try{return n.apply(this,e)}catch(t){u.__wbindgen_exn_store(a(t))}}let m=null;function T(){return(m===null||m.byteLength===0)&&(m=new Int32Array(u.memory.buffer)),m}function J(){let n,e;try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.sm3(o);var t=T()[o/4+0],r=T()[o/4+1];return n=t,e=r,v(t,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,e,1)}}function K(){let n,e;try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.sm2_encrypt(o);var t=T()[o/4+0],r=T()[o/4+1];return n=t,e=r,v(t,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,e,1)}}function Q(){u.main_js()}async function X(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof MYWebAssembly.instantiateStreaming=="function")try{return await MYWebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await MYWebAssembly.instantiate(t,e)}else{const t=await MYWebAssembly.instantiate(n,e);return t instanceof MYWebAssembly.Instance?{instance:t,module:n}:t}}function I(){const n={};return n.wbg={},n.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return _(function(){const e=self.self;return a(e)},arguments)},n.wbg.__wbg_window_c6fb939a7f436783=function(){return _(function(){const e=window.window;return a(e)},arguments)},n.wbg.__wbindgen_object_drop_ref=function(e){D(e)},n.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return _(function(){const e=globalThis.globalThis;return a(e)},arguments)},n.wbg.__wbg_global_207b558942527489=function(){return _(function(){const e=global.global;return a(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){return s(e)===void 0},n.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){const r=new Function(v(e,t));return a(r)},n.wbg.__wbg_call_27c0f87801dedf93=function(){return _(function(e,t){const r=s(e).call(s(t));return a(r)},arguments)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=s(e);return a(t)},n.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){const t=s(e).crypto;return a(t)},n.wbg.__wbindgen_is_object=function(e){const t=s(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_process_4a72847cc503995b=function(e){const t=s(e).process;return a(t)},n.wbg.__wbg_versions_f686565e586dd935=function(e){const t=s(e).versions;return a(t)},n.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){const t=s(e).node;return a(t)},n.wbg.__wbindgen_is_string=function(e){return typeof s(e)=="string"},n.wbg.__wbg_require_cca90b1a94a0255b=function(){return _(function(){const e=module.require;return a(e)},arguments)},n.wbg.__wbindgen_is_function=function(e){return typeof s(e)=="function"},n.wbg.__wbindgen_string_new=function(e,t){const r=v(e,t);return a(r)},n.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return _(function(e,t,r){const o=s(e).call(s(t),s(r));return a(o)},arguments)},n.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){const t=s(e).msCrypto;return a(t)},n.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(e){const t=new Uint8Array(e>>>0);return a(t)},n.wbg.__wbindgen_memory=function(){const e=u.memory;return a(e)},n.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){const t=s(e).buffer;return a(t)},n.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,t,r){const o=new Uint8Array(s(e),t>>>0,r>>>0);return a(o)},n.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return _(function(e,t){s(e).randomFillSync(D(t))},arguments)},n.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(e,t,r){const o=s(e).subarray(t>>>0,r>>>0);return a(o)},n.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return _(function(e,t){s(e).getRandomValues(s(t))},arguments)},n.wbg.__wbg_new_63b92bc8671ed464=function(e){const t=new Uint8Array(s(e));return a(t)},n.wbg.__wbg_set_a47bac70306a19a7=function(e,t,r){s(e).set(s(t),r>>>0)},n.wbg.__wbg_log_5bb5f88f245d7762=function(e){console.log(s(e))},n.wbg.__wbindgen_throw=function(e,t){throw new Error(v(e,t))},n}function L(n,e){return u=n.exports,U.__wbindgen_wasm_module=e,m=null,p=null,u.__wbindgen_start(),u}function Z(n){if(u!==void 0)return u;const e=I();n instanceof MYWebAssembly.Module||(n=new MYWebAssembly.Module(n));const t=new MYWebAssembly.Instance(n,e);return L(t,n)}async function U(n){if(u!==void 0)return u;const e=I(),{instance:t,module:r}=await X(await n,e);return L(t,r)}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:U,initSync:Z,main_js:Q,sm2_encrypt:K,sm3:J},Symbol.toStringTag,{value:"Module"}));worker.onMessage(function(n){console.log("received worker operation",n);const{method:e,args:t,id:r}=n,o=ee[e](...t);worker.postMessage({id:r,result:o})});U("/sm-crypto/crypto.wasm").then(n=>{console.log("module loaded successfully",n),worker.postMessage({id:-1,event:"ready"})}).catch(console.error);
