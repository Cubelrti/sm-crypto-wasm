"use strict";let o=null;function h(){const t="sm-crypto/workers/sm-crypto.js";return console.log("init smcrypto worker"),new Promise((s,e)=>{var i;try{o=my.createWorker(t,{useExperimentalWorker:!0}),o.onMessage(({id:r,event:m,message:n})=>{r===-1&&m==="ready"&&(console.log("[sm-crypto] worker ready"),s()),r===-1&&m==="log"&&console.warn(n)}),(i=o.onProcessKilled)==null||i.call(o,r=>{console.warn("[sm-crypto] worker process killed",r)})}catch(r){console.warn(r),o.terminate(),e(r)}})}let _=0;function c(t){return(...s)=>new Promise((e,i)=>{const r=_++,m=Date.now();let n={};const u=s.length;n.len=s.length,n.method=t,n.id=r;for(let a=0;a<u;a++){let l=s[a];l instanceof Uint8Array?n[a]=Array.from(l):n[a]=l}console.log(`[sm-crypto] call method: ${t}, id: ${r}`);let p=setTimeout(()=>{i(new Error(`timeout for id: ${r}`))},1e3);o.onMessage(a=>{let{id:l,event:d,message:g,result:y,type:k}=a;if(l===-1&&d==="log"&&console.warn(g),l===r){clearTimeout(p);const f=Date.now();console.log(`[sm-crypto] perf: ${t} took ${f-m}ms, id: ${r}`),Array.isArray(y)&&(y=new Uint8Array(y)),e(y)}}),o.postMessage(n)})}const w={initSMCrypto:h,sm2:{generateKeyPairHex:c("sm2_generate_keypair"),compressPublicKeyHex:c("compress_public_key_hex"),encrypt(t,s,e){return e=Object.assign({cipherMode:1,asn1:!1,output:"array"},e),e.output==="string"?c("sm2_encrypt_hex")(s,t,{asn1:e.asn1,c1c2c3:e.cipherMode===0}):c("sm2_encrypt")(s,t,{asn1:e.asn1,c1c2c3:e.cipherMode===0})},decrypt(t,s,e){return e=Object.assign({cipherMode:1,asn1:!1,output:"array"},e),e.output==="string"?c("sm2_decrypt_hex")(s,t,{asn1:e.asn1,c1c2c3:e.cipherMode===0}):c("sm2_decrypt")(s,t,{asn1:e.asn1,c1c2c3:e.cipherMode===0})},initRNGPool:c("init_rng_pool")},sm3:c("sm3"),hmac:c("sm3_hmac"),sm4:c("sm4_encrypt")};module.exports=w;
