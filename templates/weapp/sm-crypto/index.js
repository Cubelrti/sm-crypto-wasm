"use strict";function m(e,n,t){return n<=e&&e<=t}function X(e,n){return e.indexOf(n)!==-1}function D(e){if(e===void 0)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function Q(e){for(var n=String(e),t=n.length,r=0,o=[];r<t;){var i=n.charCodeAt(r);if(i<55296||i>57343)o.push(i);else if(56320<=i&&i<=57343)o.push(65533);else if(55296<=i&&i<=56319)if(r===t-1)o.push(65533);else{var f=n.charCodeAt(r+1);if(56320<=f&&f<=57343){var a=i&1023,s=f&1023;o.push(65536+(a<<10)+s),r+=1}else o.push(65533)}r+=1}return o}function Y(e){for(var n="",t=0;t<e.length;++t){var r=e[t];r<=65535?n+=String.fromCharCode(r):(r-=65536,n+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return n}function Z(e){return 0<=e&&e<=127}var ee=Z,O=-1;function W(e){this.tokens=[].slice.call(e),this.tokens.reverse()}W.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():O},prepend:function(e){if(Array.isArray(e))for(var n=e;n.length;)this.tokens.push(n.pop());else this.tokens.push(e)},push:function(e){if(Array.isArray(e))for(var n=e;n.length;)this.tokens.unshift(n.shift());else this.tokens.unshift(e)}};var A=-1;function I(e,n){if(e)throw TypeError("Decoder error");return n||65533}function N(e){return e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(R,e)?R[e]:null}var ne=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"}],R={};ne.forEach(function(e){e.encodings.forEach(function(n){n.labels.forEach(function(t){R[t]=n})})});var G={},V={},H="utf-8";function h(e,n){if(!(this instanceof h))throw TypeError("Called as a function. Did you forget 'new'?");e=e!==void 0?String(e):H,n=D(n),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var t=N(e);if(t===null||t.name==="replacement")throw RangeError("Unknown encoding: "+e);if(!V[t.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?");var r=this;return r._encoding=t,n.fatal&&(r._error_mode="fatal"),n.ignoreBOM&&(r._ignoreBOM=!0),Object.defineProperty||(this.encoding=r._encoding.name.toLowerCase(),this.fatal=r._error_mode==="fatal",this.ignoreBOM=r._ignoreBOM),r}Object.defineProperty&&(Object.defineProperty(h.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(h.prototype,"fatal",{get:function(){return this._error_mode==="fatal"}}),Object.defineProperty(h.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}}));h.prototype.decode=function(n,t){var r;typeof n=="object"&&n instanceof ArrayBuffer?r=new Uint8Array(n):typeof n=="object"&&"buffer"in n&&n.buffer instanceof ArrayBuffer?r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength):r=new Uint8Array(0),t=D(t),this._do_not_flush||(this._decoder=V[this._encoding.name]({fatal:this._error_mode==="fatal"}),this._BOMseen=!1),this._do_not_flush=!!t.stream;for(var o=new W(r),i=[],f;;){var a=o.read();if(a===O||(f=this._decoder.handler(o,a),f===A))break;f!==null&&(Array.isArray(f)?i.push.apply(i,f):i.push(f))}if(!this._do_not_flush){do{if(f=this._decoder.handler(o,o.read()),f===A)break;f!==null&&(Array.isArray(f)?i.push.apply(i,f):i.push(f))}while(!o.endOfStream());this._decoder=null}function s(l){return X(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)&&!this._ignoreBOM&&!this._BOMseen&&(l.length>0&&l[0]===65279?(this._BOMseen=!0,l.shift()):l.length>0&&(this._BOMseen=!0)),Y(l)}return s.call(this,i)};function v(e,n){if(!(this instanceof v))throw TypeError("Called as a function. Did you forget 'new'?");n=D(n),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=n.fatal?"fatal":"replacement";var t=this;if(n.NONSTANDARD_allowLegacyEncoding){e=e!==void 0?String(e):H;var r=N(e);if(r===null||r.name==="replacement")throw RangeError("Unknown encoding: "+e);if(!G[r.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");t._encoding=r}else t._encoding=N("utf-8");return Object.defineProperty||(this.encoding=t._encoding.name.toLowerCase()),t}Object.defineProperty&&Object.defineProperty(v.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}});v.prototype.encode=function(n,t){n=n===void 0?"":String(n),t=D(t),this._do_not_flush||(this._encoder=G[this._encoding.name]({fatal:this._fatal==="fatal"})),this._do_not_flush=!!t.stream;for(var r=new W(Q(n)),o=[],i;;){var f=r.read();if(f===O||(i=this._encoder.handler(r,f),i===A))break;Array.isArray(i)?o.push.apply(o,i):o.push(i)}if(!this._do_not_flush){for(;i=this._encoder.handler(r,r.read()),i!==A;)Array.isArray(i)?o.push.apply(o,i):o.push(i);this._encoder=null}return new Uint8Array(o)};function te(e){var n=e.fatal,t=0,r=0,o=0,i=128,f=191;this.handler=function(a,s){if(s===O&&o!==0)return o=0,I(n);if(s===O)return A;if(o===0){if(m(s,0,127))return s;if(m(s,194,223))o=1,t=s&31;else if(m(s,224,239))s===224&&(i=160),s===237&&(f=159),o=2,t=s&15;else if(m(s,240,244))s===240&&(i=144),s===244&&(f=143),o=3,t=s&7;else return I(n);return null}if(!m(s,i,f))return t=o=r=0,i=128,f=191,a.prepend(s),I(n);if(i=128,f=191,t=t<<6|s&63,r+=1,r!==o)return null;var l=t;return t=o=r=0,l}}function re(e){e.fatal,this.handler=function(n,t){if(t===O)return A;if(ee(t))return t;var r,o;m(t,128,2047)?(r=1,o=192):m(t,2048,65535)?(r=2,o=224):m(t,65536,1114111)&&(r=3,o=240);for(var i=[(t>>6*r)+o];r>0;){var f=t>>6*(r-1);i.push(128|f&63),r-=1}return i}}G["UTF-8"]=function(e){return new re(e)};V["UTF-8"]=function(e){return new te(e)};var k=k||globalThis||{};k.TextEncoder=typeof v>"u"?v:k.TextEncoder;k.TextDecoder=typeof h>"u"?h:k.TextDecoder;let c;const q=typeof h<"u"?new h("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof h<"u"&&q.decode();let S=null;function B(){return(S===null||S.byteLength===0)&&(S=new Uint8Array(c.memory.buffer)),S}function p(e,n){return e=e>>>0,q.decode(B().subarray(e,e+n))}const y=new Array(128).fill(void 0);y.push(void 0,null,!0,!1);let E=y.length;function _(e){E===y.length&&y.push(y.length+1);const n=E;if(E=y[n],typeof E!="number")throw new Error("corrupt heap");return y[n]=e,n}function u(e){return y[e]}function M(e){if(typeof e!="boolean")throw new Error(`expected a boolean argument, found ${typeof e}`)}function $(e){const n=typeof e;if(n=="number"||n=="boolean"||e==null)return`${e}`;if(n=="string")return`"${e}"`;if(n=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(n=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let i="[";o>0&&(i+=$(e[0]));for(let f=1;f<o;f++)i+=", "+$(e[f]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(t.length>1)r=t[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}let w=0;const U=typeof v<"u"?new v("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},oe=typeof U.encodeInto=="function"?function(e,n){return U.encodeInto(e,n)}:function(e,n){const t=U.encode(e);return n.set(t),{read:e.length,written:t.length}};function C(e,n,t){if(typeof e!="string")throw new Error(`expected a string argument, found ${typeof e}`);if(t===void 0){const a=U.encode(e),s=n(a.length,1)>>>0;return B().subarray(s,s+a.length).set(a),w=a.length,s}let r=e.length,o=n(r,1)>>>0;const i=B();let f=0;for(;f<r;f++){const a=e.charCodeAt(f);if(a>127)break;i[o+f]=a}if(f!==r){f!==0&&(e=e.slice(f)),o=t(o,r,r=f+e.length*3,1)>>>0;const a=B().subarray(o+f,o+r),s=oe(e,a);if(s.read!==e.length)throw new Error("failed to pass whole string");f+=s.written,o=t(o,r,f,1)>>>0}return w=f,o}let j=null;function g(){return(j===null||j.byteLength===0)&&(j=new Int32Array(c.memory.buffer)),j}function ie(e){e<132||(y[e]=E,E=e)}function x(e){const n=u(e);return ie(e),n}function P(e,n){const t=n(e.length*1,1)>>>0;return B().set(e,t/1),w=e.length,t}function fe(e){const n=P(e,c.__wbindgen_malloc),t=w;c.init_rng_pool(n,t)}function ce(){let e,n;try{const o=c.__wbindgen_add_to_stack_pointer(-16);c.sm3(o);var t=g()[o/4+0],r=g()[o/4+1];return e=t,n=r,p(t,r)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_free(e,n,1)}}function se(e,n){let t,r;try{const f=c.__wbindgen_add_to_stack_pointer(-16),a=C(e,c.__wbindgen_malloc,c.__wbindgen_realloc),s=w,l=P(n,c.__wbindgen_malloc),T=w;c.sm2_encrypt(f,a,s,l,T);var o=g()[f/4+0],i=g()[f/4+1];return t=o,r=i,p(o,i)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_free(t,r,1)}}function ue(){const e=c.sm2_generate_keypair();return x(e)}function ae(e){let n,t;try{const l=c.__wbindgen_add_to_stack_pointer(-16),T=C(e,c.__wbindgen_malloc,c.__wbindgen_realloc),F=w;c.compress_public_key_hex(l,T,F);var r=g()[l/4+0],o=g()[l/4+1],i=g()[l/4+2],f=g()[l/4+3],a=r,s=o;if(f)throw a=0,s=0,x(i);return n=a,t=s,p(a,s)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_free(n,t,1)}}function _e(e,n,t){let r,o;try{const a=c.__wbindgen_add_to_stack_pointer(-16),s=C(e,c.__wbindgen_malloc,c.__wbindgen_realloc),l=w,T=P(n,c.__wbindgen_malloc),F=w,J=P(t,c.__wbindgen_malloc),K=w;c.sm4_encrypt(a,s,l,T,F,J,K);var i=g()[a/4+0],f=g()[a/4+1];return r=i,o=f,p(i,f)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_free(r,o,1)}}function d(e,n){try{return e.apply(this,n)}catch(t){let r=function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",r),t}}function b(e,n){try{return e.apply(this,n)}catch(t){c.__wbindgen_exn_store(_(t))}}async function de(e,n){const t=await WXWebAssembly.instantiate(e,n);return t instanceof WXWebAssembly.Instance?{instance:t,module:e}:t}function le(){const e={};return e.wbg={},e.wbg.__wbindgen_error_new=function(n,t){const r=new Error(p(n,t));return _(r)},e.wbg.__wbindgen_string_new=function(n,t){const r=p(n,t);return _(r)},e.wbg.__wbg_error_f851667af71bcfc6=function(){return d(function(n,t){let r,o;try{r=n,o=t,console.error(p(n,t))}finally{c.__wbindgen_free(r,o,1)}},arguments)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){return d(function(){const n=new Error;return _(n)},arguments)},e.wbg.__wbg_stack_658279fe44541cf6=function(){return d(function(n,t){const r=u(t).stack,o=C(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=w;g()[n/4+1]=i,g()[n/4+0]=o},arguments)},e.wbg.__wbindgen_is_object=function(n){const t=u(n),r=typeof t=="object"&&t!==null;return M(r),r},e.wbg.__wbindgen_object_clone_ref=function(n){const t=u(n);return _(t)},e.wbg.__wbg_set_f975102236d3c502=function(){return d(function(n,t,r){u(n)[x(t)]=x(r)},arguments)},e.wbg.__wbg_log_5bb5f88f245d7762=function(){return d(function(n){console.log(u(n))},arguments)},e.wbg.__wbindgen_is_string=function(n){const t=typeof u(n)=="string";return M(t),t},e.wbg.__wbg_crypto_1d1f22824a6a080c=function(){return d(function(n){return _({getRandomValues:function(r){console.warn("[Warning] sm-crypto-wasm: It is dangerous to use non-cryptographically secure random number generator in production. Please populate RNG seed first from a secure source using 'smCrypto.initRNGPool()' API.");for(let o=0,i=r.length;o<i;o++)r[o]=Math.floor(Math.random()*256);return r}})},arguments)},e.wbg.__wbg_msCrypto_eb05e62b530a1508=function(){return d(function(n){const t=u(n).msCrypto;return _(t)},arguments)},e.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return b(function(n,t){u(n).getRandomValues(u(t))},arguments)},e.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return b(function(n,t){u(n).randomFillSync(x(t))},arguments)},e.wbg.__wbg_require_cca90b1a94a0255b=function(){return b(function(){const n=module.require;return _(n)},arguments)},e.wbg.__wbg_process_4a72847cc503995b=function(){return d(function(n){const t=u(n).process;return _(t)},arguments)},e.wbg.__wbg_versions_f686565e586dd935=function(){return d(function(n){const t=u(n).versions;return _(t)},arguments)},e.wbg.__wbg_node_104a2ff8d6ea03a2=function(){return d(function(n){const t=u(n).node;return _(t)},arguments)},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(){return d(function(n,t){const r=new Function(p(n,t));return _(r)},arguments)},e.wbg.__wbg_call_27c0f87801dedf93=function(){return b(function(n,t){const r=u(n).call(u(t));return _(r)},arguments)},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return b(function(n,t,r){const o=u(n).call(u(t),u(r));return _(o)},arguments)},e.wbg.__wbg_new_72fb9a18b5ae2624=function(){return d(function(){const n=new Object;return _(n)},arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return b(function(){const n=globalThis.globalThis;return _(n)},arguments)},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return b(function(){const n=self.self;return _(n)},arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return b(function(){const n=window.window;return _(n)},arguments)},e.wbg.__wbg_global_207b558942527489=function(){return b(function(){const n=k.global;return _(n)},arguments)},e.wbg.__wbg_new_63b92bc8671ed464=function(){return d(function(n){const t=new Uint8Array(u(n));return _(t)},arguments)},e.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(){return d(function(n){const t=new Uint8Array(n>>>0);return _(t)},arguments)},e.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(){return d(function(n,t,r){const o=new Uint8Array(u(n),t>>>0,r>>>0);return _(o)},arguments)},e.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(){return d(function(n,t,r){const o=u(n).subarray(t>>>0,r>>>0);return _(o)},arguments)},e.wbg.__wbg_set_a47bac70306a19a7=function(){return d(function(n,t,r){u(n).set(u(t),r>>>0)},arguments)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(){return d(function(n){const t=u(n).buffer;return _(t)},arguments)},e.wbg.__wbindgen_is_function=function(n){const t=typeof u(n)=="function";return M(t),t},e.wbg.__wbindgen_is_undefined=function(n){const t=u(n)===void 0;return M(t),t},e.wbg.__wbindgen_debug_string=function(n,t){const r=$(u(t)),o=C(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=w;g()[n/4+1]=i,g()[n/4+0]=o},e.wbg.__wbindgen_object_drop_ref=function(n){x(n)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(p(n,t))},e.wbg.__wbindgen_rethrow=function(n){throw x(n)},e.wbg.__wbindgen_memory=function(){const n=c.memory;return _(n)},e}function ge(e,n){return c=e.exports,z.__wbindgen_wasm_module=n,j=null,S=null,c.__wbindgen_start(),c}async function z(e){if(c!==void 0)return c;const n=le(),{instance:t,module:r}=await de(await e,n);return ge(t,r)}let L=null;async function we(){if(!L)try{const e=await z("/sm-crypto/crypto.wasm");console.log("init sm-crypto-wasm direct success",e),L=e}catch(e){console.log("init sm-crypto-wasm direct failed",e),L=null}}const he={initSMCrypto:we,sm2:{generateKeyPairHex:ue,compressPublicKeyHex:ae,encrypt:se,initRNGPool:fe},sm3:ce,sm4:_e};module.exports=he;
