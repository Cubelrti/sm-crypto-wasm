"use strict";function p(n,e,t){return e<=n&&n<=t}function K(n,e){return n.indexOf(e)!==-1}function M(n){if(n===void 0)return{};if(n===Object(n))return n;throw TypeError("Could not convert argument to dictionary")}function X(n){for(var e=String(n),t=e.length,r=0,o=[];r<t;){var f=e.charCodeAt(r);if(f<55296||f>57343)o.push(f);else if(56320<=f&&f<=57343)o.push(65533);else if(55296<=f&&f<=56319)if(r===t-1)o.push(65533);else{var i=e.charCodeAt(r+1);if(56320<=i&&i<=57343){var _=f&1023,c=i&1023;o.push(65536+(_<<10)+c),r+=1}else o.push(65533)}r+=1}return o}function J(n){for(var e="",t=0;t<n.length;++t){var r=n[t];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}function Q(n){return 0<=n&&n<=127}var Y=Q,v=-1;function L(n){this.tokens=[].slice.call(n),this.tokens.reverse()}L.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():v},prepend:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.push(e.pop());else this.tokens.push(n)},push:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.unshift(e.shift());else this.tokens.unshift(n)}};var A=-1;function U(n,e){if(n)throw TypeError("Decoder error");return e||65533}function P(n){return n=String(n).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(F,n)?F[n]:null}var Z=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"}],F={};Z.forEach(function(n){n.encodings.forEach(function(e){e.labels.forEach(function(t){F[t]=e})})});var R={},W={},V="utf-8";function g(n,e){if(!(this instanceof g))throw TypeError("Called as a function. Did you forget 'new'?");n=n!==void 0?String(n):V,e=M(e),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var t=P(n);if(t===null||t.name==="replacement")throw RangeError("Unknown encoding: "+n);if(!W[t.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?");var r=this;return r._encoding=t,e.fatal&&(r._error_mode="fatal"),e.ignoreBOM&&(r._ignoreBOM=!0),Object.defineProperty||(this.encoding=r._encoding.name.toLowerCase(),this.fatal=r._error_mode==="fatal",this.ignoreBOM=r._ignoreBOM),r}Object.defineProperty&&(Object.defineProperty(g.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(g.prototype,"fatal",{get:function(){return this._error_mode==="fatal"}}),Object.defineProperty(g.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}}));g.prototype.decode=function(e,t){var r;typeof e=="object"&&e instanceof ArrayBuffer?r=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):r=new Uint8Array(0),t=M(t),this._do_not_flush||(this._decoder=W[this._encoding.name]({fatal:this._error_mode==="fatal"}),this._BOMseen=!1),this._do_not_flush=!!t.stream;for(var o=new L(r),f=[],i;;){var _=o.read();if(_===v||(i=this._decoder.handler(o,_),i===A))break;i!==null&&(Array.isArray(i)?f.push.apply(f,i):f.push(i))}if(!this._do_not_flush){do{if(i=this._decoder.handler(o,o.read()),i===A)break;i!==null&&(Array.isArray(i)?f.push.apply(f,i):f.push(i))}while(!o.endOfStream());this._decoder=null}function c(d){return K(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)&&!this._ignoreBOM&&!this._BOMseen&&(d.length>0&&d[0]===65279?(this._BOMseen=!0,d.shift()):d.length>0&&(this._BOMseen=!0)),J(d)}return c.call(this,f)};function m(n,e){if(!(this instanceof m))throw TypeError("Called as a function. Did you forget 'new'?");e=M(e),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=e.fatal?"fatal":"replacement";var t=this;if(e.NONSTANDARD_allowLegacyEncoding){n=n!==void 0?String(n):V;var r=P(n);if(r===null||r.name==="replacement")throw RangeError("Unknown encoding: "+n);if(!R[r.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");t._encoding=r}else t._encoding=P("utf-8");return Object.defineProperty||(this.encoding=t._encoding.name.toLowerCase()),t}Object.defineProperty&&Object.defineProperty(m.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}});m.prototype.encode=function(e,t){e=e===void 0?"":String(e),t=M(t),this._do_not_flush||(this._encoder=R[this._encoding.name]({fatal:this._fatal==="fatal"})),this._do_not_flush=!!t.stream;for(var r=new L(X(e)),o=[],f;;){var i=r.read();if(i===v||(f=this._encoder.handler(r,i),f===A))break;Array.isArray(f)?o.push.apply(o,f):o.push(f)}if(!this._do_not_flush){for(;f=this._encoder.handler(r,r.read()),f!==A;)Array.isArray(f)?o.push.apply(o,f):o.push(f);this._encoder=null}return new Uint8Array(o)};function $(n){var e=n.fatal,t=0,r=0,o=0,f=128,i=191;this.handler=function(_,c){if(c===v&&o!==0)return o=0,U(e);if(c===v)return A;if(o===0){if(p(c,0,127))return c;if(p(c,194,223))o=1,t=c&31;else if(p(c,224,239))c===224&&(f=160),c===237&&(i=159),o=2,t=c&15;else if(p(c,240,244))c===240&&(f=144),c===244&&(i=143),o=3,t=c&7;else return U(e);return null}if(!p(c,f,i))return t=o=r=0,f=128,i=191,_.prepend(c),U(e);if(f=128,i=191,t=t<<6|c&63,r+=1,r!==o)return null;var d=t;return t=o=r=0,d}}function ee(n){n.fatal,this.handler=function(e,t){if(t===v)return A;if(Y(t))return t;var r,o;p(t,128,2047)?(r=1,o=192):p(t,2048,65535)?(r=2,o=224):p(t,65536,1114111)&&(r=3,o=240);for(var f=[(t>>6*r)+o];r>0;){var i=t>>6*(r-1);f.push(128|i&63),r-=1}return f}}R["UTF-8"]=function(n){return new ee(n)};W["UTF-8"]=function(n){return new $(n)};var O=O||globalThis||{};O.TextEncoder=typeof m>"u"?m:O.TextEncoder;O.TextDecoder=typeof g>"u"?g:O.TextDecoder;let s;const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);function a(n){return h[n]}let C=h.length;function ne(n){n<132||(h[n]=C,C=n)}function x(n){const e=a(n);return ne(n),e}const G=typeof g<"u"?new g("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof g<"u"&&G.decode();let E=null;function B(){return(E===null||E.byteLength===0)&&(E=new Uint8Array(s.memory.buffer)),E}function y(n,e){return n=n>>>0,G.decode(B().subarray(n,n+e))}function u(n){C===h.length&&h.push(h.length+1);const e=C;return C=h[e],h[e]=n,e}let k=null;function l(){return(k===null||k.byteLength===0)&&(k=new Int32Array(s.memory.buffer)),k}function te(){let n,e;try{const o=s.__wbindgen_add_to_stack_pointer(-16);s.sm3(o);var t=l()[o/4+0],r=l()[o/4+1];return n=t,e=r,y(t,r)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(n,e,1)}}let b=0;const j=typeof m<"u"?new m("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},re=typeof j.encodeInto=="function"?function(n,e){return j.encodeInto(n,e)}:function(n,e){const t=j.encode(n);return e.set(t),{read:n.length,written:t.length}};function N(n,e,t){if(t===void 0){const _=j.encode(n),c=e(_.length,1)>>>0;return B().subarray(c,c+_.length).set(_),b=_.length,c}let r=n.length,o=e(r,1)>>>0;const f=B();let i=0;for(;i<r;i++){const _=n.charCodeAt(i);if(_>127)break;f[o+i]=_}if(i!==r){i!==0&&(n=n.slice(i)),o=t(o,r,r=i+n.length*3,1)>>>0;const _=B().subarray(o+i,o+r),c=re(n,_);i+=c.written,o=t(o,r,i,1)>>>0}return b=i,o}function I(n,e){const t=e(n.length*1,1)>>>0;return B().set(n,t/1),b=n.length,t}function oe(n,e){let t,r;try{const i=s.__wbindgen_add_to_stack_pointer(-16),_=N(n,s.__wbindgen_malloc,s.__wbindgen_realloc),c=b,d=I(e,s.__wbindgen_malloc),T=b;s.sm2_encrypt(i,_,c,d,T);var o=l()[i/4+0],f=l()[i/4+1];return t=o,r=f,y(o,f)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(t,r,1)}}function ie(){const n=s.sm2_generate_keypair();return x(n)}function fe(n){let e,t;try{const d=s.__wbindgen_add_to_stack_pointer(-16),T=N(n,s.__wbindgen_malloc,s.__wbindgen_realloc),S=b;s.compress_public_key_hex(d,T,S);var r=l()[d/4+0],o=l()[d/4+1],f=l()[d/4+2],i=l()[d/4+3],_=r,c=o;if(i)throw _=0,c=0,x(f);return e=_,t=c,y(_,c)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(e,t,1)}}function ce(n,e,t){let r,o;try{const _=s.__wbindgen_add_to_stack_pointer(-16),c=N(n,s.__wbindgen_malloc,s.__wbindgen_realloc),d=b,T=I(e,s.__wbindgen_malloc),S=b,q=I(t,s.__wbindgen_malloc),z=b;s.sm4_encrypt(_,c,d,T,S,q,z);var f=l()[_/4+0],i=l()[_/4+1];return r=f,o=i,y(f,i)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(r,o,1)}}function w(n,e){try{return n.apply(this,e)}catch(t){s.__wbindgen_exn_store(u(t))}}async function se(n,e){const t=await WXWebAssembly.instantiate(n,e);return t instanceof WXWebAssembly.Instance?{instance:t,module:n}:t}function _e(){const n={};return n.wbg={},n.wbg.__wbindgen_object_drop_ref=function(e){x(e)},n.wbg.__wbindgen_string_new=function(e,t){const r=y(e,t);return u(r)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=a(e);return u(t)},n.wbg.__wbg_set_f975102236d3c502=function(e,t,r){a(e)[x(t)]=x(r)},n.wbg.__wbg_log_5bb5f88f245d7762=function(e){console.log(a(e))},n.wbg.__wbg_new_72fb9a18b5ae2624=function(){const e=new Object;return u(e)},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(y(e,t));return u(r)},n.wbg.__wbindgen_is_object=function(e){const t=a(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){return u({getRandomValues:function(r){console.warn("[Warning] It is dangerous to use non-cryptographically secure random number generator in production. Please populate RNG seed first from a secure source using 'smCrypto.initRNGPool()' API.");for(let o=0,f=r.length;o<f;o++)r[o]=Math.floor(Math.random()*256);return r}})},n.wbg.__wbg_process_4a72847cc503995b=function(e){const t=a(e).process;return u(t)},n.wbg.__wbg_versions_f686565e586dd935=function(e){const t=a(e).versions;return u(t)},n.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){const t=a(e).node;return u(t)},n.wbg.__wbindgen_is_string=function(e){return typeof a(e)=="string"},n.wbg.__wbg_require_cca90b1a94a0255b=function(){return w(function(){const e=module.require;return u(e)},arguments)},n.wbg.__wbindgen_is_function=function(e){return typeof a(e)=="function"},n.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return w(function(e,t,r){const o=a(e).call(a(t),a(r));return u(o)},arguments)},n.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){const t=a(e).msCrypto;return u(t)},n.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(e){const t=new Uint8Array(e>>>0);return u(t)},n.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return w(function(){const e=self.self;return u(e)},arguments)},n.wbg.__wbg_window_c6fb939a7f436783=function(){return w(function(){const e=window.window;return u(e)},arguments)},n.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return w(function(){const e=globalThis.globalThis;return u(e)},arguments)},n.wbg.__wbg_global_207b558942527489=function(){return w(function(){const e=O.global;return u(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){return a(e)===void 0},n.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){const r=new Function(y(e,t));return u(r)},n.wbg.__wbg_call_27c0f87801dedf93=function(){return w(function(e,t){const r=a(e).call(a(t));return u(r)},arguments)},n.wbg.__wbindgen_memory=function(){const e=s.memory;return u(e)},n.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){const t=a(e).buffer;return u(t)},n.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,t,r){const o=new Uint8Array(a(e),t>>>0,r>>>0);return u(o)},n.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return w(function(e,t){a(e).randomFillSync(x(t))},arguments)},n.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(e,t,r){const o=a(e).subarray(t>>>0,r>>>0);return u(o)},n.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return w(function(e,t){a(e).getRandomValues(a(t))},arguments)},n.wbg.__wbg_new_63b92bc8671ed464=function(e){const t=new Uint8Array(a(e));return u(t)},n.wbg.__wbg_set_a47bac70306a19a7=function(e,t,r){a(e).set(a(t),r>>>0)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(y(e,t))},n}function ae(n,e){return s=n.exports,H.__wbindgen_wasm_module=e,k=null,E=null,s.__wbindgen_start(),s}async function H(n){if(s!==void 0)return s;const e=_e(),{instance:t,module:r}=await se(await n,e);return ae(t,r)}let D=null;async function ue(){if(!D)try{const n=await H("/sm-crypto/crypto.wasm");console.log("init sm-crypto-wasm direct success",n),D=n}catch(n){console.log("init sm-crypto-wasm direct failed",n),D=null}}const de={initSMCrypto:ue,sm2:{generateKeyPairHex:ie,compressPublicKeyHex:fe,encrypt:oe},sm3:te,sm4:ce};module.exports=de;
